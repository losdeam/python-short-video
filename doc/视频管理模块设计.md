## 流程图
### 上传
![](https://cdn.nlark.com/yuque/0/2023/jpeg/40362764/1698990174261-daa58f38-b0fc-4020-8fa1-b1708ed48bf8.jpeg)
### 删除
![](https://cdn.nlark.com/yuque/0/2023/jpeg/40362764/1699240979744-28d72de6-2216-4ead-aa56-3aab7046ec61.jpeg)
### 审核
![](https://cdn.nlark.com/yuque/0/2023/jpeg/40362764/1699250975184-2aa0398e-6ec9-4769-a03d-de4c886b5161.jpeg)
### 查询
#### 自身创作查询
![](https://cdn.nlark.com/yuque/0/2023/jpeg/40362764/1699259545527-178d9ae6-827f-4d53-98f9-7aec97d3ef3b.jpeg)
#### 视频分类查询
![](https://cdn.nlark.com/yuque/0/2023/jpeg/40362764/1699259435840-86fae605-a527-4b8d-941e-701be2e03fed.jpeg)

## 


## 设计思路：
### 上传：

1. 在程序初始化时，将保存在qny_config.py文件中的七牛云SDK相关配置进行读取。
2. 用户将视频信息（视频名称，视频分类）上传至服务器中，由前端的cookie中获取用户的id信息
3. 将用户id信息作为前缀添加在视频原名称前，以"_"作为分隔，作为传入存储空间后保存的视频名
4. 服务器对接受到的数据进行视频存在性验证，查验储存空间中是否已经存在同名视频，若不存在，则进行下一步，若存在，则向客户端返回404错误，表示已存在相同文件
5. 根据所给视频名称使用七牛云SDK中提供的token生成函数来生成对应token
6. 使用对应token将文件上传至七牛云对象存储中的中转空间中
7. 等待审核员的审核，若通过，视频将会转移至正式存储空间中，若不通过，视频则会删除并通过邮箱通知用户。

### 删除：

1. 在程序初始化时，将保存在qny_config.py文件中的七牛云SDK相关配置进行读取。
2. 用户将视频名称（视频名称）上传至服务器中，由前端的cookie中获取用户的id信息
3. 将用户id信息作为前缀添加在视频原名称前，以"_"作为分隔，作为传入存储空间后保存的视频名
4. 服务器对接受到的数据进行视频存在性验证，若存在，则进行下一步，若不存在，则向客户端返回404错误，表示该名称的文件在空间中不存在
5. 通过数据库查询用户是否有权限对该视频进行删除操作，若有，则进行下一步。若无，则向客户端返回403错误，表示该用户无权删除该文件
6. 根据所给视频名称使用七牛云SDK中提供的文件删除函数来将七牛云对象存储空间中的文件

### 审核：

1. 在程序初始化时，将保存在qny_config.py文件中的七牛云SDK相关配置进行读取。
2. 用户将视频名称（视频名称）与审核结果上传至服务器中，由前端的cookie中获取用户的id信息
3. 服务器通过数据库查询用户是否有权限对视频进行审核，若是可以，进入审核模块，若是不行，则向客户端返回404错误，表示当前用户无审核权限
4. 若审核通过，则通过视频转移模块将中转空间中的视频转移至正式空间中，并正式将视频信息存放入数据库中。若是审核不通过，则调用视频删除模块将中转空间中的视频删除，并以邮件的形式通知视频上传用户


### 查询：
#### 自身创作查询

1. 在程序初始化时，将保存在qny_config.py文件中的七牛云SDK相关配置进行读取。
2. 用户将想要查询的空间（已审核/待审核）上传至服务器中，由前端的cookie中获取用户的id信息
3. 使用用户的id作为前缀调用七牛云SDK中提供的前缀搜索函数来获取视频信息
4. 通过
5. 通过去除前缀后将视频列表返回给前端进行调用
#### 视频分类查询

1. 在程序初始化时，将保存在qny_config.py文件中的七牛云SDK相关配置进行读取。
2. 用户将分类（视频名称）上传至服务器中
3. 服务器使用数据库来查询对应分类信息的视频地址，通过获取前20名热度最高的视频来进行返回

### 模块设计
#### 用户权限验证模块：

1. 获取前端返回的id
2. 在数据库中查询该id是否为视频上传者或管理员权限拥有者
3. 返回查询情况

#### 视频存在性验证模块：

1. 获取前端返回的视频名称
2. 根据所给视频名称使用七牛云SDK中提供的文件查询函数来查询七牛云对象存储空间（中转空间与正式空间）中是否存在该文件
3. 返回验证结果

#### 视频上传模块：

1. 获取前端返回的视频信息
2. 通过七牛云SDK中提供的函数对提供的数据进行urlsafe的base64编码
3. 将编码数据通过七牛云SDK中提供的二进制文件上传函数，将视频信息进行上传
4. 返回上传结果

 
#### 视频查询模块：

1. 获取前端返回的视频名称
2. 根据所给视频名称使用七牛云SDK中提供的前缀查询函数来查询七牛云对象存储空间中包含该前缀的视频文件
3. 返回查询结果

#### 视频删除模块：

1. 获取前端返回的视频名称与视频所在存储空间
2. 使用七牛云SDK中提供的文件删除函数，将视频所在存储空间中的对应视频删除
3. 返回删除结果

#### 视频转移模块

1. 获取前端返回的视频名称
2. 使用七牛云SDK中提供的文件移动函数，将中转空间中的对应视频移动至正式空间中
3. 返回转移结果

#### 视频地址获取模块

1. 获取前端返回的视频名称与视频所在存储空间
2. 使用七牛云SDK中提供的地址获取函数，获取所在存储空间中的对应视频的播放地址
3. 返回获取结果


